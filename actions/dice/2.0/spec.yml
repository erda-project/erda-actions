name: dice
version: "2.0"
type: action
category: deploy_management
displayName: ${{ i18n.displayName }}
logoUrl: //terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2020/09/28/fdb44148-35a3-4a91-a459-84dd197a55ae.png
desc: ${{ i18n.desc }}
public: true
supportedVersions: # Deprecated. Please use supportedErdaVersions instead.
  - ">= 3.5"
supportedErdaVersions:
  - ">= 1.6"

params:
  - name: release_id
    desc: ${{ i18n.params.release_id.desc }}
    default: ${release:OUTPUT:releaseID}
  - name: release_name
    desc: ${{ i18n.params.release_name.desc }}
  - name: type
    desc: ${{ i18n.params.type.desc }}
  - name: application_name
    desc: ${{ i18n.params.application_name.desc }}
  - name: deploy_without_branch
    desc: ${{ i18n.params.deploy_without_branch.desc }}
  - name: time_out
    type: int
    desc: ${{ i18n.params.time_out.desc }}
    default: 1800
  - name: workspace
    desc: ${{ i18n.params.workspace.desc }}
  - name: callback
    desc: ${{ i18n.params.callback.desc }}
  - name: release_id_path
    desc: ${{ i18n.params.release_id_path.desc }}

accessibleAPIs:
  # deployment order create
  - path: /api/deployment-orders
    method: POST
    schema: http
  # deployment status
  - path: /api/deployments/<deploymentId>/status
    method: GET
    schema: http
  # deployment order status
  - path: /api/deployment-orders/<deploymentOrderID>
    method: GET
    schema: http
  # pipeline callback
  - path: /api/pipelines/actions/callback
    method: GET
    schema: http
  # cancel deployment order deploying
  - path: /api/deployment-orders/<deploymentOrderID>/actions/cancel
    method: POST
    schema: http

outputs:
  - name: runtimeID
    desc: ${{ i18n.outputs.runtimeID.desc }}
locale:
  zh-CN:
    desc: 用于 Erda 平台部署应用服务
    displayName: 平台应用部署
    outputs.runtimeID.desc: 部署中心运行时 ID
    params.callback.desc: 回调地址，仅支持 POST 方法，用于通知部署结果
    params.release_id.desc: 制品 ID，一般通过表达式语法从前置 Release-Action 获取。
    params.release_id_path.desc: <废弃，请使用 release_id 参数> 包含 dicehub_release 文件的目录地址(dicehub_release 文件由 Release-Action 生成)。例如：${release}
    params.deploy_without_branch: 无分支名称部署, 项目级/应用级制品部署默认无分支名称，通过 release_id 部署时候可以选择该参数。
    params.time_out.desc: 部署超时时间(秒)
    params.workspace.desc: 环境(DEV/TEST/STAGING/PROD)，一般情况下无需指定。Erda 根据制品自动选择环境。
    params.release_name: 制品名称
    params.type.desc: 制品类型, 可选：项目制品 (project)、应用制品(application)
    params.application_name.desc: 应用名称, 应用制品发布时候需要指定应用名称

  en-US:
    desc: Used to deploy application services on the Erda platform
    displayName: Application deployment on the platform
    outputs.runtimeID.desc: Runtime id
    params.callback.desc: Callback address, only supports POST method to notify the deployment result.
    params.release_id.desc: The artifact ID, generally obtained from the pre-release-action via expression syntax.
    params.release_id_path.desc: "<Deprecated, use the release_id parameter> Contains the directory address of the dicehub_release file (the dicehub_release file is generated by the release-action). For example: ${release}."
    params.deploy_without_branch: Deploy without branch name, project-level/application-level artifact deployment by default without branch name, deployment by release_id can be selected by this parameter.
    params.time_out.desc: Deployment timeout (seconds)
    params.workspace.desc: Environment (DEV/TEST/STAGING/PROD), which does not need to be specified generally. Erda automatically selects the environment based on the artifact.
    params.release_name.desc: The artifact name
    params.type.desc: The artifact type, optional, project artifact (project), application artifact (application)
    params.application_name.desc: Application name, required when deploying application artifacts